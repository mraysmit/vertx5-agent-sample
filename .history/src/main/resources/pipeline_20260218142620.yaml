# ============================================================================
# Pipeline Configuration
#
# This file defines the entire pipeline wiring: event bus addresses, HTTP
# endpoint, field validation, agent settings, deterministic handlers, agent
# tools, and LLM client selection.
#
# Loaded at startup by PipelineConfigLoader from the classpath.
# Override the path via: -Dpipeline.config=my-config.yaml
# ============================================================================

# ── Event bus addresses ──────────────────────────────────────────────────────
addresses:
  inbound: "trade.failures"
  agent:   "agent.required"
  events:  "events.out"

# ── HTTP ingress ─────────────────────────────────────────────────────────────
http:
  port: 8080
  route: "/trade/failures"
  requestTimeoutMs: 10000

# ── Schema / field validation ────────────────────────────────────────────────
schema:
  caseIdField: "tradeId"
  allowedFields:
    - tradeId
    - reason
    - altIds
  requiredFields:
    - tradeId
    - reason

# ── Agent settings ───────────────────────────────────────────────────────────
agent:
  maxSteps: 5
  timeoutMs: 10000

# ── Deterministic handlers (reason → handler type + params) ──────────────────
# Supported types:
#   lookup-enrich  — looks up and enriches a missing identifier
#                    params: { identifier: "<name>" }
#   escalate       — escalates the failure for manual review
#                    params: (none)
handlers:
  - reason: "Missing ISIN"
    type: "lookup-enrich"
    params:
      identifier: "ISIN"

  - reason: "Invalid Counterparty"
    type: "escalate"

# ── Agent tools ──────────────────────────────────────────────────────────────
# Supported types:
#   publish-event  — publishes arbitrary domain events
#   raise-ticket   — creates a support ticket
tools:
  - type: "publish-event"
  - type: "raise-ticket"

# ── LLM client ──────────────────────────────────────────────────────────────
# Supported types:
#   stub    — rule-based stub for local dev (no network calls)
#   openai  — placeholder for real LLM integration
#             params: { endpoint: "...", apiKey: "${OPENAI_API_KEY}", model: "gpt-4" }
llm:
  type: "stub"
